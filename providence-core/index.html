<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-10-24 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20171024" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Providence &#x2013; Providence Core</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/morimekta/providence">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Providence Core</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2017-10-24
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.7.1
                      </li>
                      
              
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Project Documentation</li>
                                                                                                                    
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                      
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
                              <li class="nav-header">Introduction</li>
                              
      <li>
  
                          <a href="../index.html" title="Providence">
          <span class="none"></span>
        Providence</a>
            </li>
                
      <li>
  
                          <a href="../models.html" title="Providence Models">
          <span class="none"></span>
        Providence Models</a>
            </li>
                
      <li>
  
                          <a href="../services.html" title="Providence Services">
          <span class="none"></span>
        Providence Services</a>
            </li>
                
      <li>
  
                          <a href="../apache-thrift.html" title="Comparing with Thrift">
          <span class="none"></span>
        Comparing with Thrift</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/morimekta/providence/releases" class="externalLink" title="Downloads & Releases">
          <span class="none"></span>
        Downloads & Releases</a>
            </li>
                              <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="../providence-core/index.html" title="Core">
          <span class="none"></span>
        Core</a>
            </li>
                
      <li>
  
                          <a href="../providence-core-client/index.html" title="Core : Client">
          <span class="none"></span>
        Core : Client</a>
            </li>
                
      <li>
  
                          <a href="../providence-core-server/index.html" title="Core : Server">
          <span class="none"></span>
        Core : Server</a>
            </li>
                
      <li>
  
                          <a href="../providence-core-jackson/index.html" title="Core : Jackson">
          <span class="none"></span>
        Core : Jackson</a>
            </li>
                
      <li>
  
                          <a href="../providence-reflect/index.html" title="Utils : Reflect">
          <span class="none"></span>
        Utils : Reflect</a>
            </li>
                
      <li>
  
                          <a href="../providence-thrift/index.html" title="Utils : Thrift Bridge">
          <span class="none"></span>
        Utils : Thrift Bridge</a>
            </li>
                
      <li>
  
                          <a href="../providence-testing/index.html" title="Utils : Testing">
          <span class="none"></span>
        Utils : Testing</a>
            </li>
                
      <li>
  
                          <a href="../providence-config/index.html" title="Utils : Config">
          <span class="none"></span>
        Utils : Config</a>
            </li>
                
      <li>
  
                          <a href="../providence-storage/index.html" title="Utils : Storage">
          <span class="none"></span>
        Utils : Storage</a>
            </li>
                
      <li>
  
                          <a href="../providence-storage-hazelcast/index.html" title="Utils : Storage - Hazelcast">
          <span class="none"></span>
        Utils : Storage - Hazelcast</a>
            </li>
                
      <li>
  
                          <a href="../providence-jax-rs/index.html" title="Utils : Javax-Ws-Rs">
          <span class="none"></span>
        Utils : Javax-Ws-Rs</a>
            </li>
                
      <li>
  
                          <a href="../providence-generator/index.html" title="Tools : Generator">
          <span class="none"></span>
        Tools : Generator</a>
            </li>
                
      <li>
  
                          <a href="../providence-generator-java/index.html" title="Tools : Generator - Java">
          <span class="none"></span>
        Tools : Generator - Java</a>
            </li>
                
      <li>
  
                          <a href="../providence-generator-json/index.html" title="Tools : Generator - JSON">
          <span class="none"></span>
        Tools : Generator - JSON</a>
            </li>
                
      <li>
  
                          <a href="../providence-maven-plugin/index.html" title="Tools : Maven Plugin">
          <span class="none"></span>
        Tools : Maven Plugin</a>
            </li>
                
      <li>
  
                          <a href="../providence-gradle-plugin.html" title="Tools : Gradle Plugin">
          <span class="none"></span>
        Tools : Gradle Plugin</a>
            </li>
                              <li class="nav-header">CLI Tools</li>
                              
      <li>
  
                          <a href="../providence-tools-converter.html" title="CLI : Converter">
          <span class="none"></span>
        CLI : Converter</a>
            </li>
                
      <li>
  
                          <a href="../providence-tools-rpc.html" title="CLI : RPC Tool">
          <span class="none"></span>
        CLI : RPC Tool</a>
            </li>
                
      <li>
  
                          <a href="../providence-tools-config.html" title="CLI : Config Helper">
          <span class="none"></span>
        CLI : Config Helper</a>
            </li>
                
      <li>
  
                          <a href="../providence-tools-compiler.html" title="CLI : Compiler">
          <span class="none"></span>
        CLI : Compiler</a>
            </li>
                              <li class="nav-header">Generator Options</li>
                              
      <li>
  
                          <a href="../options.html" title="Options Overview">
          <span class="none"></span>
        Options Overview</a>
            </li>
                
      <li>
  
                          <a href="../options-hazelcast.html" title="Hazelcast Portable">
          <span class="none"></span>
        Hazelcast Portable</a>
            </li>
                
      <li>
  
                          <a href="../options-android.html" title="Android Parcelable">
          <span class="none"></span>
        Android Parcelable</a>
            </li>
                
      <li>
  
                          <a href="../options-jackson.html" title="Jackson Annotations">
          <span class="none"></span>
        Jackson Annotations</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="../release.html" title="Release Process">
          <span class="none"></span>
        Release Process</a>
            </li>
                
      <li>
  
                          <a href="../integration-testing.html" title="Integration Testing">
          <span class="none"></span>
        Integration Testing</a>
            </li>
                
      <li>
  
                          <a href="../serializer-binary.html" title="Serializer : Binary">
          <span class="none"></span>
        Serializer : Binary</a>
            </li>
                
      <li>
  
                          <a href="../serializer-fast-binary.html" title="Serializer : Fast Binary">
          <span class="none"></span>
        Serializer : Fast Binary</a>
            </li>
                
      <li>
  
                          <a href="../serializer-json.html" title="Serializer : JSON">
          <span class="none"></span>
        Serializer : JSON</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Providence Core</h1>
<p>The core providence library contains classes that should handle and enable the generated code, except for some special cases. It handles the descriptors, base classes for the models and model builder themselves and common utilities for working with the model classes. There are interfaces for using the services, but not the implementations for working with them, see <a href="../providence-core-client/index.html">providence-core-client</a> and <a href="../providence-core-server/index.html">providence-core-server</a> modules for more on using the services.</p>
<p><b>PS:</b> <i>Note that for the most part, the user should not need to worry about these libraries, with some exceptions.</i></p>
<div class="section">
<h2><a name="Base_Classes_And_Utilities"></a>Base Classes And Utilities</h2>
<p>As described in <a href="../models.html">providence models</a>, there are generated methods for getting each field from the structures, and how to build it. But as providence is built to be self-reflective / self-describing, these same classes need more generic methods to be able to build and read the model content without relying on java reflection. Notable features are following.</p>
<div class="section">
<h3><a name="PMessage_and_PMessageBuilder"></a>PMessage and PMessageBuilder</h3>
<p>All structures implements a base interface called the <tt>PMessage</tt>. It has utility methods to dynamically check and get the content of the message. Both classes have a <tt>descriptor()</tt> method that returns the descriptor for the message. See below for details. Also the message implementation class will always have a <tt>kDescriptor</tt> constant containing the same.</p>
<p>The functionality of the <tt>PMessage</tt> is basically only the <tt>get(i)</tt>, <tt>has(i)</tt> methods, and the more notable:</p>

<ul>
  
<li><tt>mutate()</tt>: Returns a builder that further builds upon / mutates the content  from the instance.</li>
  
<li><tt>mergeWith(Message other)</tt>: Essentially just <tt>mutate().merge(other).build()</tt>,  but handy to have in order to quickly make messages by merging two of the  same type.</li>
</ul>
<p>The <tt>PMessageBuilkder</tt> has a bit more features to be noted. These are added mainly in order to facilitate &#x201c;smarter&#x201d; ways or handling updates and changes.</p>

<ul>
  
<li><tt>valid</tt>() and <tt>validate()</tt> checks if, and fails if not (respectively) the  current content of the message builder constitutes a valid message when  comparing it to the field requirements of the type.</li>
  
<li><tt>isSet(field)</tt> and <tt>presentFields()</tt> are respectively returning true if  the specified field has a value, and the list of fields that has a value  at time of calling.</li>
  
<li><tt>isModified(field)</tt> and <tt>modifiedFields()</tt> are respectively returning true  if the specified field has been modified since the builder was created, and  the list of fields that has been modified since the builder was created at  time of calling.</li>
  
<li><tt>mutator(field)</tt> returns a contained <tt>PMessageBuilder</tt> for the specified  field. The returned builder is &#x201c;contained&#x201d; in the outer builder so that  any modifications to this builder will affect the contained message.  Corresponds to the <tt>mutableMyField()</tt> (if field named &#x2018;my_field&#x2019;) method.</li>
</ul></div>
<div class="section">
<h3><a name="Descriptors"></a>Descriptors</h3>
<p>As noted above, providence is self-describing. This is done via a set of <tt>PDeclaredDescriptor</tt> implementations, one for each generated base class. As a user, you should usually only need to know that all the generated classes have a <tt>kDescriptor</tt> constant, which is passed into serializers and other utilities to represent the type.</p>
<p>The descriptors also have some niceties that can be used to represent the generated class.</p></div></div>
<div class="section">
<h2><a name="Serialization"></a>Serialization</h2>
<p>Serialization and deserialization of providence models are done through the <tt>Serializer</tt> interface. It&#x2019;s main interface are the <tt>serialize</tt> and <tt>deserialize</tt> methods. Both methods will to it&#x2019;s job and return if and <i>only if</i> the read or write operations succeeded.</p>

<ul>
  
<li><tt>int serialize(OutputStream os, PMessage m)</tt>: Serialize message with the  serializer onto the output stream. Since the message is self-describing no  descriptor is needed. It should return the number of bytes written.</li>
  
<li><tt>T deserialize(InputStream is, PDescriptor&lt;T&gt; t)</tt>: Read an object of type T  with the descriptor t from the input stream. The object does not have to be a  Message, ant serializable type should work.</li>
</ul>
<p>The available serializers are as follows:</p>

<ul>
  
<li><b>BinarySerializer</b>: A native providence version of the thrift&#x2019;s  <b>TBinaryProtocol</b> binary format. It should generate the same serialized  data as TBinaryProtocol, and be able to parse data back from the same. It is  the default serializer in the <tt>pvdrpc</tt> tool. See  <a href="../serializer-binary.html">binary serializer spec</a> for details.</li>
  
<li><b>FastBinarySerializer</b>: A compact and efficient serialization format. The  serializer is designed to have a balance of computational and data  efficiency. See <a href="../serializer-fast-binary.html">fast binary serializer spec</a>  for details.</li>
  
<li><b>JsonSerializer</b>: A general purpose JSON serializer. This should be able  to read most generic JSON formats into providence structs that match with  name to field type mapping. See  <a href="../serializer-json.html">json serializer spec</a> for details.</li>
  
<li><b>PrettySerializer</b>: A serializer format for making and reading a pure human  readable format. The format is also used in the providence config, but with  some extra features. See <a href="../providence-config/index.html">providence-config</a>  for details on the pretty config format.</li>
</ul>
<div class="section">
<h3><a name="Serializer_Providers"></a>Serializer Providers</h3>
<p>Often when using serializers a system may need to be able to select a fitting serializer for the current task. This is done with the <tt>SerializerProvider</tt> interface, which simply let&#x2019;s a service get a serializer based on a media type string.</p></div>
<div class="section">
<h3><a name="A_Note_on_Strictness"></a>A Note on Strictness</h3>
<p>All of the base serializers have a <tt>strict</tt> option. And this controls how strict the parser or generator can be when reading and writing the messages. In essence:</p>

<ul>
  
<li>If strict is <tt>true</tt>, only data accepted by the generated code made by  <tt>apache thrift</tt> will be accepted. Meaning:
  
<ul>
    
<li>If a <tt>required</tt> field in a message is missing, reading it will fail. E.g.  validation failure.</li>
    
<li>If a map key, or set value cannot be resolved, it will be &#x2018;null&#x2019; and fail  reading. This is mostly only applicable to enums reading an unknown value.</li>
  </ul></li>
  
<li>Otherwise the failures above will be handled as:
  
<ul>
    
<li><tt>required</tt> fields are handled as if they were <tt>optional_in_required_out</tt>,  a.k.a. <tt>default</tt> requirement.</li>
    
<li>Unresolved enum values for map keys and set values are just ignored.</li>
  </ul></li>
  
<li>If strict is <tt>false</tt>, the examples above will be accepted, but a number of  other issues will still fail reading a message:
  
<ul>
    
<li>If any value does not have a compatible wire format to it&#x2019;s described type,  the read will fail. This may happen if fields change type, or if two  separate services have added a field with the same ID (or name for some  serializers).</li>
    
<li>If any value fails to be parsed (for the requested type), e.g. bad string  utf-8 entities, too large (or small) number for parsed <tt>i*</tt> types, etc.</li>
  </ul></li>
</ul>
<p>Writing a message should only fail if writing to the stream fails. A message usually <i>cannot</i> contain an invalid value. This is a result or how the message builder works, which in practice (if the user calls <tt>build()</tt> on the builder, it makes a valid message instance regardless).</p></div>
<div class="section">
<h3><a name="Example_use_of_Serialization."></a>Example use of Serialization.</h3>
<p>In the simplest form, serializers are used plainly on inout and output streams.</p>

<div class="source">
<div class="source"><pre class="prettyprint">class Example {
    void write(MyMessage message) {
        BinarySerializer serializer = new BinarySerializer();
        FileOutputStream out = new FileOutputStream(new File(&quot;test.data&quot;));
        serializer.serialize(out, message);
    }

    MyMessage read() {
        BinarySerializer serializer = new BinarySerializer();
        FileInputStream in = new FileInputStream(new File(&quot;test.data&quot;));
        return serializer.deserialize(in, MyMessage.kDescriptor);
    }
}
</pre></div></div></div></div>
<div class="section">
<h2><a name="Message_IO"></a>Message I/O</h2>
<p>Since using the Serializers require knowing more about the source of and how to handle multiple message in one etc, there is added a MessageIO library. The interface is mostly a simplification of use of the Serializers, making specialized <tt>MessageReader</tt> and <tt>MessageWriter</tt> classes.</p>

<ul>
  
<li><tt>IOMessageReader</tt> and <tt>IOMessageWriter</tt> are simply wrappers around input stream  and output stream that handles streaming multiple messages, with optional  internal separators (e.g. for JSON).</li>
  
<li><tt>FileMessageReader</tt> and <tt>FileMessageWriter</tt> writes to and reads from a single  file that is appended to and read from as a stream of messages, also with optional  internal separators.</li>
</ul>
<div class="section">
<h3><a name="Streams"></a>Streams</h3>
<p>Convenience methods for creating java 8 streams from an input stream containing providence data. These are mostly for convenience, but with added handling of a stream of content, meaning multiple messages in a row in the same stream. It is mostly just wrappers around the two <tt>MessageReader</tt> &amp; <tt>MessageWriter</tt> implementations.</p>

<ul>
  
<li><tt>MessageStreams.file(File f, PSerializer s, PDescriptor d)</tt>: Consume  messages from the file using the given serializer one at a time onto the  stream.</li>
  
<li><tt>MessageStreams.resource(String r, PSerializer, s, PDescriptor d)</tt>: Consume  messages from the java resource using the given serializer one at a time  onto the stream.</li>
  
<li><tt>MessageStreams.stream(InputStream in, PSerializer, s, PDescriptor d)</tt>: Consume  messages from the input stream using the given serializer one at a time  onto the stream.</li>
  
<li><tt>MessageCollectors.toFile(File f, PSerializer s)</tt>: Collect messages and write  them to file with the given serializer.</li>
  
<li><tt>MessageCollectors.toStream(OutputStream os, PSerializer s)</tt>: Collect  messages and write them to the given output stream with the given serializer.</li>
</ul></div>
<div class="section">
<h3><a name="Storage"></a>Storage</h3>
<p>If you need a simple data storage layer for providence messages, take a look at the <a href="../providence-storage/index.html">providence-storage</a> module.</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                          <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-3087264-4', 'auto');
                ga('send', 'pageview');
            </script>
                </div>

        
                </div>
    </footer>
        </body>
</html>
