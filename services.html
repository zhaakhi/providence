<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2018-01-02 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180102" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Providence &#x2013; Providence Services</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
                      <a href="https://github.com/morimekta/providence">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Providence</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2018-01-02<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0.0</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
          <li class="nav-header">Introduction</li>
    <li><a href="index.html" title="Providence"><span class="none"></span>Providence</a>  </li>
    <li><a href="models.html" title="Providence Models"><span class="none"></span>Providence Models</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Providence Services</a>
  </li>
    <li><a href="apache-thrift.html" title="Comparing with Thrift"><span class="none"></span>Comparing with Thrift</a>  </li>
    <li><a href="https://github.com/morimekta/providence/releases" class="externalLink" title="Downloads & Releases"><span class="none"></span>Downloads & Releases</a>  </li>
          <li class="nav-header">Modules</li>
    <li><a href="providence-core/index.html" title="Core"><span class="none"></span>Core</a>  </li>
    <li><a href="providence-core-client/index.html" title="Core : Client"><span class="none"></span>Core : Client</a>  </li>
    <li><a href="providence-core-server/index.html" title="Core : Server"><span class="none"></span>Core : Server</a>  </li>
    <li><a href="providence-core-jackson/index.html" title="Core : Jackson"><span class="none"></span>Core : Jackson</a>  </li>
    <li><a href="providence-reflect/index.html" title="Utils : Reflect"><span class="none"></span>Utils : Reflect</a>  </li>
    <li><a href="providence-testing/index.html" title="Utils : Testing"><span class="none"></span>Utils : Testing</a>  </li>
    <li><a href="providence-thrift/index.html" title="Utils : Thrift Bridge"><span class="none"></span>Utils : Thrift Bridge</a>  </li>
    <li><a href="providence-storage/index.html" title="Utils : Storage"><span class="none"></span>Utils : Storage</a>  </li>
    <li><a href="providence-config/index.html" title="Utils : Config (beta)"><span class="none"></span>Utils : Config (beta)</a>  </li>
    <li><a href="providence-storage-hazelcast/index.html" title="Utils : Storage - Hazelcast (beta)"><span class="none"></span>Utils : Storage - Hazelcast (beta)</a>  </li>
    <li><a href="providence-jax-rs/index.html" title="Utils : Javax-Ws-Rs (beta)"><span class="none"></span>Utils : Javax-Ws-Rs (beta)</a>  </li>
    <li><a href="providence-generator/index.html" title="Tools : Generator"><span class="none"></span>Tools : Generator</a>  </li>
    <li><a href="providence-generator-java/index.html" title="Tools : Generator - Java"><span class="none"></span>Tools : Generator - Java</a>  </li>
    <li><a href="providence-maven-plugin/index.html" title="Tools : Maven Plugin"><span class="none"></span>Tools : Maven Plugin</a>  </li>
    <li><a href="providence-gradle-plugin.html" title="Tools : Gradle Plugin"><span class="none"></span>Tools : Gradle Plugin</a>  </li>
          <li class="nav-header">CLI Tools</li>
    <li><a href="providence-tools-converter.html" title="CLI : Converter"><span class="none"></span>CLI : Converter</a>  </li>
    <li><a href="providence-tools-rpc.html" title="CLI : RPC Tool"><span class="none"></span>CLI : RPC Tool</a>  </li>
    <li><a href="providence-tools-config.html" title="CLI : Config Helper"><span class="none"></span>CLI : Config Helper</a>  </li>
    <li><a href="providence-tools-generator.html" title="CLI : Generator"><span class="none"></span>CLI : Generator</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="release.html" title="Release Process"><span class="none"></span>Release Process</a>  </li>
    <li><a href="integration-testing.html" title="Integration Testing"><span class="none"></span>Integration Testing</a>  </li>
    <li><a href="serializer-binary.html" title="Serializer : Binary"><span class="none"></span>Serializer : Binary</a>  </li>
    <li><a href="serializer-fast-binary.html" title="Serializer : Fast Binary"><span class="none"></span>Serializer : Fast Binary</a>  </li>
    <li><a href="serializer-json.html" title="Serializer : JSON"><span class="none"></span>Serializer : JSON</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Providence Services</h1>
<p>Services (a.k.a. thrift services) have a couple of implicit handling around it. The way this is organized in providence is by defining as much as possible around the service call handling in thrift as possible.</p>
<div class="section">
<h2><a name="Service_Definition"></a>Service Definition</h2>
<p>Services are in essence an interface defined solely from thrift messages and types. Example simple service:</p>

<div class="source">
<div class="source"><pre class="prettyprint">service MyService {
    i32 myMethod(1: i32 param);
}
</pre></div></div>
<p>There can also be declared extra thrift <tt>exceptions</tt> on any service method, each being an <tt>exception</tt> type message, and is declared in a <tt>throws</tt> block after the method params, like:</p>

<div class="source">
<div class="source"><pre class="prettyprint">exception MyException {
    1: string message;
}

service MyService {
    i32 myMethod(1: i32 param) throws (1: MyException me);
}
</pre></div></div></div>
<div class="section">
<h2><a name="Generated_Classes"></a>Generated Classes</h2>
<p>For each service there is generated a single <tt>Service</tt> class. The service class itself actually have no functionality, but contains a number of inner classes that do.</p>

<ul>
  
<li><b>[IFace]</b>: An interface that defines what the service is. This has a 1-to-1  mapping in methods to the declared service methods.</li>
  
<li><b>[Client]</b>: A class that implements the <tt>IFace</tt> interface, and takes a  single <tt>PClientHandler</tt> instance as constructor argument. The class is the  generated code bridge between the service interface and the client handling  code found in <a href="providence-core-server/index.html">providence-core-client</a>  used to communicate with actual remote services.</li>
  
<li><b>[Processor]</b>: A class that implements the <tt>PProcessor</tt> interface, and takes  a single <tt>IFace</tt> implementation as argument. This is the interface between  a server implementation, e.g. <tt>ProvidenceServlet</tt> and the service implementation  actually doing the job.</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">class MyService {
    public interface IFace {
        int myMethod(int param) throws MyException;
    }

    public static class Client implements IFace {
        public Client(PServiceCallHandler handler) {
            // ...
        }

        public int myMethod(int param) throws MyException {
            // transform the method call into a generic
            // call on handler.
        }
    }

    public static class Processor implements PProcessor {
        public Processor(IFace impl) {
            // ...
        }

        public PServiceCall handleCall(PServiceCall call) {
            // ... handle the call and call iface.myMethod()
        }
    }
}
</pre></div></div>
<p>Note that the <tt>PProcessor</tt> interface extends the <tt>PServiceCall</tt> method, so the rather useless construct <tt>IFace iface ? new Client(new Processor(new MyServiceImpl()))</tt> is a valid java. If you find yourself getting this construct for some reason: <i>try to get the implementation instance directly instead</i>.</p>
<div class="section">
<h3><a name="Implicit_Handling"></a>Implicit Handling</h3>
<div class="section">
<h4><a name="Service_Interface"></a>Service Interface</h4>
<p>The service is declare initially as a simple interface which mimics the service declaration from the thrift file, and then logic is added around that. E.g. the the <tt>ApplicationException</tt> and <tt>IOException</tt> exceptions are added in the <tt>java</tt> client implementations.</p></div></div>
<div class="section">
<h3><a name="Service_calls"></a>Service calls</h3>
<p>Service calls is a way to handle a request and a response so that the actual code can work with a service as if it was &#x201c;just an implementation&#x201d; of the generated interface. The call is defined by a &#x2018;call type (id)&#x2019;, grouped as request or response.</p>
<p>There are two types of requests:</p>

<ul>
  
<li><tt>call</tt> (1): Normal method call request. Requires a response (even for void return types).</li>
  
<li><tt>oneway</tt> (4): A void type call request that does not require a response, and can only  throw an exception if the error occurs on the client side <i>before</i> the actual  call message is sent.</li>
</ul>
<p>And there are two types of responses:</p>

<ul>
  
<li><tt>reply</tt> (2): This handled both the &#x201c;normal&#x201d; response of the method using the &#x201c;return&#x201d;  type of the method, or any of the declared exception types in the &#x201c;throws&#x201d; section  of the service call definition.</li>
  
<li><tt>exception</tt> (3): Also called &#x2018;application exception&#x2019; is handling of exceptions from  either the client handlers, or from the providence (or thrift) server handlers  themselves.</li>
</ul>
<p>Each actual service call message must have this information:</p>

<ul>
  
<li>The name of the method called, as declared in the service, used by the service  handler to call the correct service method, and handle message serialization.</li>
  
<li>A call type, must be one of the types above.</li>
  
<li>A sequence number, which e.g. may be used in a Muxer/DeMuxer used to route  responses back the the correct caller. A response&#x2019;s sequence number <b>must</b>  be the same as given by the request.</li>
  
<li>And a <tt>request</tt>, <tt>response</tt> or <tt>exception</tt> message, which can <b>NOT</b> be null  itself.</li>
</ul>
<div class="section">
<h4><a name="Application_Exceptions"></a>Application Exceptions</h4>
<p>This is a response type where the object is a non-declared exception. E.g. the service implementation threw an undeclared runtime exception, e.g. a NullPointerException or IllegalArgumentException, or serialization failed, or there was IO or network problems. This is wrapped into the &#x201c;ApplicationException&#x201d;, which all service calls can throw.</p>
<p>The application exceptions are defined as:</p>

<div class="source">
<div class="source"><pre class="prettyprint">enum ApplicationExceptionType {
  # Any exception not matching anything below.
  UNKNOWN                 =  0;
  # the requested method (name) is not known to the service.
  UNKNOWN_METHOD          =  1;
  # the serialized message type is not compatible with the locally declared message.
  INVALID_MESSAGE_TYPE    =  2;
  # the method name in the response does not match the call.
  WRONG_METHOD_NAME       =  3;
  # the response sequence ID does not match the one from the request.
  BAD_SEQUENCE_ID         =  4;
  # The response is empty (or null).
  MISSING_RESULT          =  5;
  # Unknown or unhandled exception from the client or service handler.
  INTERNAL_ERROR          =  6;
  # Serialization error.
  PROTOCOL_ERROR          =  7;
  # TODO: Figure out what this type means.
  # AFAIK it is related to transport data problems.
  INVALID_TRANSFORM       =  8;
  # Protocol mismatch.
  INVALID_PROTOCOL        =  9;
  # The client type (???) is not supported.
  UNSUPPORTED_CLIENT_TYPE = 10;
}

exception ApplicationException {
    # Textual message about the exception
    1: string message
    # The application exception type.
    2: ApplicationExceptionType id
}
</pre></div></div></div>
<div class="section">
<h4><a name="Virtual_Messages"></a>Virtual Messages</h4>
<p>Each service method will generate a virtual <tt>params</tt> struct, and each non-oneway service method will generate a virtual <tt>response</tt> union. These messages are used to wrap the called params and response data for the service method call.</p>
<p>The <tt>params</tt> struct is essentially mimicking the method params as a struct. E.g.:</p>

<div class="source">
<div class="source"><pre class="prettyprint">service Service {
    void call(1: i32 i, 2: MyStruct s) throws (1: MyFailure fail);
}
</pre></div></div>
<p>Will generate the request message definition:</p>

<div class="source">
<div class="source"><pre class="prettyprint">struct Service.call_request {
    1: i32 i;
    2: MyStruct s;
}
</pre></div></div>
<p>For the response, there is generated a virtual struct containing the response on <tt>success</tt>, using the field ID 0 (which should not be allowed to be declared, and will not be used by the non-declared auto-IDs for the exceptions), and one field for each declared exception. E.g. the example above will generate this response message definition:</p>

<div class="source">
<div class="source"><pre class="prettyprint">union Service.call_response {
    0: i32 success;
    1: MyFailure fail;
}
</pre></div></div>
<p>Note that since this is declared as a union, one (and only one) of the fields <b>must</b> be set to a non-null value for the response to be valid.</p></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-3087264-4', 'auto');
                ga('send', 'pageview');
            </script>
        </div>
        </div>
    </footer>
    </body>
</html>
