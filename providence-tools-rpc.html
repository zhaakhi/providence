<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2018-01-19 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180119" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Providence &#x2013; Providence CLI Tool : RPC Tool</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
                      <a href="https://github.com/morimekta/providence">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Providence</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2018-01-19<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.2.0</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
          <li class="nav-header">Introduction</li>
    <li><a href="index.html" title="Providence"><span class="none"></span>Providence</a>  </li>
    <li><a href="models.html" title="Providence Models"><span class="none"></span>Providence Models</a>  </li>
    <li><a href="services.html" title="Providence Services"><span class="none"></span>Providence Services</a>  </li>
    <li><a href="apache-thrift.html" title="Comparing with Thrift"><span class="none"></span>Comparing with Thrift</a>  </li>
    <li><a href="https://github.com/morimekta/providence/releases" class="externalLink" title="Downloads & Releases"><span class="none"></span>Downloads & Releases</a>  </li>
          <li class="nav-header">Modules</li>
    <li><a href="providence-core/index.html" title="Core"><span class="none"></span>Core</a>  </li>
    <li><a href="providence-core-client/index.html" title="Core : Client"><span class="none"></span>Core : Client</a>  </li>
    <li><a href="providence-core-server/index.html" title="Core : Server"><span class="none"></span>Core : Server</a>  </li>
    <li><a href="providence-core-jackson/index.html" title="Core : Jackson"><span class="none"></span>Core : Jackson</a>  </li>
    <li><a href="providence-reflect/index.html" title="Utils : Reflect"><span class="none"></span>Utils : Reflect</a>  </li>
    <li><a href="providence-testing/index.html" title="Utils : Testing"><span class="none"></span>Utils : Testing</a>  </li>
    <li><a href="providence-thrift/index.html" title="Utils : Thrift Bridge"><span class="none"></span>Utils : Thrift Bridge</a>  </li>
    <li><a href="providence-storage/index.html" title="Utils : Storage"><span class="none"></span>Utils : Storage</a>  </li>
    <li><a href="providence-config/index.html" title="Utils : Config (beta)"><span class="none"></span>Utils : Config (beta)</a>  </li>
    <li><a href="providence-storage-hazelcast/index.html" title="Utils : Storage - Hazelcast (beta)"><span class="none"></span>Utils : Storage - Hazelcast (beta)</a>  </li>
    <li><a href="providence-jax-rs/index.html" title="Utils : Javax-Ws-Rs (beta)"><span class="none"></span>Utils : Javax-Ws-Rs (beta)</a>  </li>
    <li><a href="providence-generator/index.html" title="Tools : Generator"><span class="none"></span>Tools : Generator</a>  </li>
    <li><a href="providence-generator-java/index.html" title="Tools : Generator - Java"><span class="none"></span>Tools : Generator - Java</a>  </li>
    <li><a href="providence-maven-plugin/index.html" title="Tools : Maven Plugin"><span class="none"></span>Tools : Maven Plugin</a>  </li>
    <li><a href="providence-gradle-plugin.html" title="Tools : Gradle Plugin"><span class="none"></span>Tools : Gradle Plugin</a>  </li>
          <li class="nav-header">CLI Tools</li>
    <li><a href="providence-tools-converter.html" title="CLI : Converter"><span class="none"></span>CLI : Converter</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>CLI : RPC Tool</a>
  </li>
    <li><a href="providence-tools-config.html" title="CLI : Config Helper"><span class="none"></span>CLI : Config Helper</a>  </li>
    <li><a href="providence-tools-generator.html" title="CLI : Generator"><span class="none"></span>CLI : Generator</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="release.html" title="Release Process"><span class="none"></span>Release Process</a>  </li>
    <li><a href="integration-testing.html" title="Integration Testing"><span class="none"></span>Integration Testing</a>  </li>
    <li><a href="serializer-binary.html" title="Serializer : Binary"><span class="none"></span>Serializer : Binary</a>  </li>
    <li><a href="serializer-fast-binary.html" title="Serializer : Fast Binary"><span class="none"></span>Serializer : Fast Binary</a>  </li>
    <li><a href="serializer-json.html" title="Serializer : JSON"><span class="none"></span>Serializer : JSON</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Providence CLI Tool : RPC Tool</h1>
<p>The providence RPC tool <tt>pvdrpc</tt> is a program designed to test out thrift and providence RPC service calls based on the same ad-hoc type parsing as <tt>pvd</tt> uses. It supports HTTP servlet wrapped RPC (e.g. using the <tt>TServlet</tt>), the <tt>TSimpleServer</tt> direct socket RPC, and the <tt>TNonblockingServer</tt> that also wraps the calls in sized frame buffers.</p>
<p>The providence RPC tool connects to a remote service, and sends a service call (which can be parsed from files the same way as the data files above), and sent as an actual remote procedure call:</p>
<p>Given a simple thrift service file <tt>test.thrift</tt>:</p>

<div class="source">
<div class="source"><pre class="prettyprint">struct MyTest {
    1: optional string       test;
    2: optional i32          seq;
    3: optional list&lt;string&gt; tags;
}

exception MyFailure {
    1: string message;
}

service MyService {
    MyTest test(1: MyTest request) throws (1: MyFailure failure);
}
</pre></div></div>
<p>And code that just returns the same object as requested as the implementation. Then given the request <tt>req.json</tt> file:</p>

<div class="source">
<div class="source"><pre class="prettyprint">[
  &quot;test&quot;,
  &quot;call&quot;,
  7,
  {
    &quot;request&quot;: {
      &quot;test&quot;: &quot;my test&quot;,
      &quot;seq&quot;: 44,
      &quot;tags&quot;: [
        &quot;first&quot;,
        &quot;second&quot;
      ]
    }
  }
]
</pre></div></div>
<p>Which is the RPC call data, and the shell command:</p>

<div class="source">
<div class="source"><pre class="prettyprint">cat req.json | pvdrpc -I thrift/ test.MyService http://localhost:8080/test_service
</pre></div></div>
<p>Which would then:</p>

<ul>
  
<li>Parse the thrift IDL in thrift/ directory, pick out the test.MyService service  from there.</li>
  
<li>Read the req.json request call (which needs to follow the desired input format&#x2019;s  service call syntax), and use that to send the actual RPC call to the remote  service at <tt>http://localhost:8000/test_service</tt>.</li>
  
<li>Parse the response (in whatever format returned) and print out to standard out  so the user can read it. E.g.:</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">[
  &quot;test&quot;,
  &quot;reply&quot;,
  7,
  {
    &quot;success&quot;: {
      &quot;test&quot;: &quot;my test&quot;,
      &quot;seq&quot;: 44,
      &quot;tags&quot;: [
        &quot;first&quot;,
        &quot;second&quot;
      ]
    }
  }
]
</pre></div></div>
<p>Or if a non-200 HTTP response is received will print out the error message received.</p>
<div class="section">
<div class="section">
<div class="section">
<h4><a name="Supported_Protocols"></a>Supported Protocols</h4>
<p>Short overview over the RPC protocols supported by the RPC tool.</p>

<ul>
  
<li><tt>http://</tt> and <tt>https://</tt>: Connects to a thrift <tt>TServlet</tt> or similar over <tt>HTTP/1.1</tt>  and with TLS / SSL handshake and encryption with <tt>https</tt>.</li>
  
<li><tt>thrift://</tt>: Connects to a <tt>TSimpleServer</tt> type thrift server.</li>
  
<li><tt>thrift+nonblocking://</tt>: Connects to a <tt>TNonblockingServer</tt> type thrift server,  or a similar thrift server that wraps messages in <tt>TFramedTransport</tt>.</li>
</ul>
<p><b>PS:</b> A note of warning: The <tt>TSimpleServer</tt> and <tt>TNonblockingServer</tt> <b>will</b> crash if try to connect to it with <tt>https://</tt> because of trying to allocate multiple gigabytes of RAM for the request (TNonblockingServer) or for the method name (TSimpleServer).</p></div>
<div class="section">
<h4><a name="The_Service_Call_Syntax"></a>The Service Call Syntax</h4>
<p>Note that in the two json structures shown there is the serialized service call data in addition to the request and response wrappers around the actual request and response objects. The format here is:</p>
<p><tt>[&quot;${method}&quot;, ${type}, ${sequence}, ${wrapper}]</tt></p>
<p>Where the type can be 1 / &#x201c;call&#x201d;, 2 / &#x201c;reply&#x201d;, 3 / &#x201c;exception&#x201d;, and 4 / &#x201c;oneway&#x201d;. The sequence number is something the transport layer (http, client etc) can use to match response messages to the correct caller, and the wrapper is either the <tt>request params wrapper</tt> the <tt>response wrapper</tt>, or the <tt>application exception</tt>. Oneway calls are calls the does not want a response.</p>

<ul>
  
<li>
<p>The <tt>request params wrapper</tt> message is a generated thrift struct that  contains all the method params as field values. E.g. the method  <tt>ResponseStruct my_test(1: i32 num, 2: string text)</tt> would become  equivalent to the struct:</p>
  
<div class="source">
<div class="source"><pre class="prettyprint">struct my_test___params {
  1: i32 num
  2: string text
}
</pre></div></div></li>
  
<li>
<p>The <tt>response wrapper</tt> is a wrapper of the return type (put in a field  named <tt>success</tt>), and of each possible exception put in a union. In order  to make it impossible to conflict with field IDs, the success field gets  the index <tt>0</tt>, which is not allowed to declare. E.g.:</p>
  
<div class="source">
<div class="source"><pre class="prettyprint">union my_test___response {
  0: ResponseStruct success
  1: MyException ex1
}
</pre></div></div></li>
  
<li>
<p>The <tt>application exception</tt> is a generic providence exception message that can  be passed with call type 3 (exception), usually to tell a client about a  problem that was caused outside of the actual service call, e.g. serialization  problems, bad method call, etc. It is equivalent to:</p>
  
<div class="source">
<div class="source"><pre class="prettyprint">exception ApplicationException {
    1: string message
    2: i32 type
}
</pre></div></div></li>
</ul></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-3087264-4', 'auto');
                ga('send', 'pageview');
            </script>
        </div>
        </div>
    </footer>
    </body>
</html>
