<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-04-24 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170424" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Providence &#x2013; Json Serializer Format</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
                      <a href="https://github.com/morimekta/providence">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Providence</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-04-24<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.3.91</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
          <li class="nav-header">Introduction</li>
    <li><a href="index.html" title="Providence"><span class="none"></span>Providence</a>  </li>
    <li><a href="https://github.com/morimekta/providence/releases" class="externalLink" title="Downloads & Releases"><span class="none"></span>Downloads & Releases</a>  </li>
          <li class="nav-header">Modules</li>
    <li><a href="providence-core/index.html" title="Core"><span class="none"></span>Core</a>  </li>
    <li><a href="providence-core-client/index.html" title="Core : Client"><span class="none"></span>Core : Client</a>  </li>
    <li><a href="providence-core-server/index.html" title="Core : Server"><span class="none"></span>Core : Server</a>  </li>
    <li><a href="providence-reflect/index.html" title="Utils : Reflect"><span class="none"></span>Utils : Reflect</a>  </li>
    <li><a href="providence-thrift/index.html" title="Utils : Thrift Bridge"><span class="none"></span>Utils : Thrift Bridge</a>  </li>
    <li><a href="providence-testing/index.html" title="Utils : Testing"><span class="none"></span>Utils : Testing</a>  </li>
    <li><a href="providence-config/index.html" title="Utils : Config"><span class="none"></span>Utils : Config</a>  </li>
    <li><a href="providence-storage/index.html" title="Utils : Storage"><span class="none"></span>Utils : Storage</a>  </li>
    <li><a href="providence-jax-rs/index.html" title="Utils : Javax-Ws-Rs"><span class="none"></span>Utils : Javax-Ws-Rs</a>  </li>
    <li><a href="providence-generator/index.html" title="Tools : Generator"><span class="none"></span>Tools : Generator</a>  </li>
    <li><a href="providence-generator-java/index.html" title="Tools : Generator - Java"><span class="none"></span>Tools : Generator - Java</a>  </li>
    <li><a href="providence-generator-json/index.html" title="Tools : Generator - JSON"><span class="none"></span>Tools : Generator - JSON</a>  </li>
    <li><a href="providence-maven-plugin/index.html" title="Tools : Maven Plugin"><span class="none"></span>Tools : Maven Plugin</a>  </li>
    <li><a href="providence-gradle-plugin.html" title="Tools : Gradle Plugin"><span class="none"></span>Tools : Gradle Plugin</a>  </li>
          <li class="nav-header">CLI Tools</li>
    <li><a href="providence-tools-converter.html" title="CLI : Converter"><span class="none"></span>CLI : Converter</a>  </li>
    <li><a href="providence-tools-rpc.html" title="CLI : RPC Tool"><span class="none"></span>CLI : RPC Tool</a>  </li>
    <li><a href="providence-tools-config.html" title="CLI : Config Helper"><span class="none"></span>CLI : Config Helper</a>  </li>
    <li><a href="providence-tools-compiler.html" title="CLI : Compiler"><span class="none"></span>CLI : Compiler</a>  </li>
          <li class="nav-header">Generator Options</li>
    <li><a href="options.html" title="Options Overview"><span class="none"></span>Options Overview</a>  </li>
    <li><a href="options-hazelcast.html" title="Hazelcast Portable"><span class="none"></span>Hazelcast Portable</a>  </li>
    <li><a href="options-android.html" title="Android Parcelable"><span class="none"></span>Android Parcelable</a>  </li>
    <li><a href="options-jackson.html" title="Jackson Annotations"><span class="none"></span>Jackson Annotations</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="release.html" title="Release Process"><span class="none"></span>Release Process</a>  </li>
    <li><a href="integration-testing.html" title="Integration Testing"><span class="none"></span>Integration Testing</a>  </li>
    <li><a href="serializer-binary.html" title="Serializer : Binary"><span class="none"></span>Serializer : Binary</a>  </li>
    <li><a href="serializer-fast-binary.html" title="Serializer : Fast Binary"><span class="none"></span>Serializer : Fast Binary</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Serializer : JSON</a>
  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Json Serializer Format</h1>
<p>The compact JSON serialization format is designed to be a simple format to import / export data to and from other JSON based structures. It follows the JSON data standard, and does not contain any unnecessary info per field.</p>
<p>There are two dimension variants when serializing the JSON:</p>

<ul>
  
<li>Field ID type: <tt>NAME</tt> vs <tt>ID</tt>.</li>
  
<li>Enum value type: <tt>NAME</tt> vs <tt>ID</tt>.</li>
</ul>
<p>If field ID type is NAME the thrift field name will be used. Otherwise the string value of the ID will be used. E.g. &#x201c;my_field&#x201d; vs &#x201c;4&#x201d;;</p>
<p>If enum value type is NAME the enum will be serialized based on the value name. Otherwise the value number will be used. E.g. &#x201c;ENUM_VALUE&#x201d; vs 5.</p>
<p>Binary values are encoded as strings using Base64 url safe encoding with no padding. Strings are encoded using UTF-8 encoding.</p>
<div class="section">
<h2><a name="JSON_format"></a>JSON format</h2>
<p>The <tt>JsonSerializer</tt> tries as best to conform to standard JSON formatting, so that each message (struct, exception, union) are encoded as a JSON object, where the field keys are the field names (or ID), and the values are the field value.</p>

<ul>
  
<li>Missing fields are omitted.</li>
  
<li>Maps <b>must</b> have it&#x2019;s key encoded in a string. Strings and binaries use the normal  formatting, and all others are JSON serialized values and then string escaped and  quoted.</li>
</ul>
<p>With the <tt>NAME</tt> type encoding, string names are used for field and enum values. This can be used to read classical JSON files or use (and serve) REST services.</p>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;my_string&quot;: &quot;my-string&quot;,
  &quot;my_number&quot;: 13579,
  &quot;my_boolean&quot;: false,
  &quot;my_enum&quot;: &quot;ENUM_VALUE&quot;,
  &quot;map&quot;: {
     &quot;12&quot;: 12
  }
}
</pre></div></div>
<p>With the <tt>ID</tt> type encoding, numeric values are used for field and enum values. The format is pretty compact, but is not supported by any other libraries (AFAIK). The format can be mixed with <tt>NAME</tt>, e.g. using named fields and enum ID values.</p>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;1&quot;: &quot;my-string&quot;,
  &quot;2&quot;: 13579,
  &quot;3&quot;: false,
  &quot;4&quot;: 42,
  &quot;5&quot;: {
    &quot;12&quot;: 12
  }
}
</pre></div></div>
<div class="section">
<h3><a name="Specifics_on_map_keys"></a>Specifics on map keys</h3>
<p>Since map keys have to be encoded as strings in JSON, the JSON serializer will only accept primitive types, enums and so-called <tt>simple</tt> messages as map keys. A <tt>simple</tt> message is a message that:</p>

<ul>
  
<li>No field is a container; list, set, map.</li>
  
<li>No field is a message; struct, union, exception.</li>
</ul>
<p>The actual content of the message is irrelevant when it comes to simplicity.</p></div>
<div class="section">
<h3><a name="Compact_messages"></a>Compact messages</h3>
<p>Compact JSON messages is a concept made to be able to use way less space for small (compact) messages. The criteria for a message to be <tt>json.compact</tt> is:</p>

<ul>
  
<li>Only structs may be compact (not union or exception).</li>
  
<li>May have a maximum of 10 fields.</li>
  
<li>Fields <b>must</b> be numbered 1 .. N.</li>
  
<li>A required field <b>may not</b> come after an optional field.</li>
</ul>
<p>When the compact struct is serialized the serializer may choose to use a different serialization format that serializes the first M fields of the struct in order. E.g. in JSON a compact struct may be serialized as an array if (and only if).</p>
<p>Compactible messages will have a <tt>jsonCompact()</tt> method that determines if the message is compact for serialization. The descriptor will have a similar <tt>isJsonCompactible()</tt> method which determines if the message can be deserialized with the compact format.</p>
<p>To make a struct compact, add the <tt>json.compact = &quot;&quot;</tt> annotation to the struct. This will still allow thrift compiler to parse the .thrift files. This applies both to using the <tt>JsonSerializer</tt> and using the <tt>jackson</tt> java generator option with a jackson JSON serializer and deserializer.</p>

<div class="source">
<div class="source"><pre class="prettyprint">struct Compact {
   1: string my_string;
   2: i32 my_number;
   3: bool my_boolean;
} (json.compact = &quot;&quot;)
</pre></div></div>
<div class="section">
<h4><a name="Compact_chances_to_serialization"></a>Compact chances to serialization</h4>
<p>Messages in providence are per default encoded as JSON objects. But in modes where Field-Name encoding mode is required, lists of many small messages with the same fields can have a huge overhead of field names.</p>

<ul>
  
<li>For the &#x2018;compact&#x2019; serialization to take effect, the first M fields must be set,  and no other fields may be set. E.g.:
  
<ul>
    
<li>If 1, 2 abd 3 are set, and 4, 5 are not set, then compact is used.</li>
    
<li>If 1, 2 and 4 are set, and 3, 5 are not set, compact is <b>not</b> used.</li>
  </ul></li>
</ul>
<p>When encoding the message as <tt>compact</tt>, array notation is used instead of object notation. So the message of 62 significant bytes:</p>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;my_string&quot;: &quot;my-string&quot;,
  &quot;my_number&quot;: 13579,
  &quot;my_boolean&quot;: false
}
</pre></div></div>
<p>Can be encoded as 24 significant bytes instead:</p>

<div class="source">
<div class="source"><pre class="prettyprint">[
  &quot;my-string&quot;,
  1357,
  false
]
</pre></div></div>
<p>The compact message notation works regardless of the Field-ID mode of the serializer.</p></div></div></div>
<div class="section">
<h2><a name="Service_Calls"></a>Service Calls</h2>
<p>JSON Service calls are done in a pretty compact way. It follows the &#x2018;compact&#x2019; struct definition, representing the call with a struct like:</p>

<div class="source">
<div class="source"><pre class="prettyprint">enum CallType {
  call = 1,
  reply = 2,
  exception = 3,
  oneway = 4
}

struct Call {
  1: required string name
  2: required CallType type
  3: required i32 sequence
  4: required struct message
} (json.compact = &quot;&quot;)
</pre></div></div>
<p>Where <i>what</i> the message struct is is determined by the call type. See definition of <tt>fast-binary</tt> and <tt>binary</tt> for details on service calls. An example service call would look like:</p>

<div class="source">
<div class="source"><pre class="prettyprint">[
  &quot;myMethod&quot;,
  &quot;call&quot;,
  79,
  {
    &quot;param1&quot;: 42
  }
]
</pre></div></div></div>
<div class="section">
<h2><a name="JSON_IDL_-_Data_format"></a>JSON IDL - Data format</h2>

<div class="source">
<div class="source"><pre class="prettyprint">MESSAGE     :== MESSAGE_OBJ | MESSAGE_ARR

MESSAGE_OBJ :== '{' (FIELD-SPEC ','?)* '}'

MESSAGE_ARR :== '[' (FIELD-VALUE ','?)* ']'

FIELD-SPEC  :== '&quot;' FIELD-ID '&quot;' ':' FIELD-VALUE

FIELD-ID    :== STRING | NUMBER

FIELD-VALUE :== '&quot;' STRING '&quot;' | BOOLEAN | NUMBER | LIST | MAP | MESSAGE

LIST        :== '[' (VALUE ','?)* ']'

MAP         :== '{' (MAP-ENTRY ','?)* '}'

MAP-ENTRY   :== MAP-KEY ':' FIELD-VALUE

MAP-KEY     :== STRING | '&quot;' (BOOLEAN | NUMBER) '&quot;'

STRING      :== CHAR*

CHAR        :== [0x20 .. 0x7E] | [0xC1 - 0xFD] [0x81 .. 0xBF]+

NUMBER      :== [0-9]+ | ([0-9]+ | [0-9]* ('.' [0-9]+)) (('e' | 'E') '-'? [0-9]+)?
</pre></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-3087264-4', 'auto');
                ga('send', 'pageview');
            </script>
        </div>
        </div>
    </footer>
    </body>
</html>
