<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2017-03-02 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170302" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Providence &#x2013; Binary Serializer Format</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
                      <a href="https://github.com/morimekta/providence">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Providence</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-03-02<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.3.11</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
          <li class="nav-header">Introduction</li>
    <li><a href="index.html" title="Providence"><span class="none"></span>Providence</a>  </li>
    <li><a href="https://github.com/morimekta/providence/releases" class="externalLink" title="Downloads & Releases"><span class="none"></span>Downloads & Releases</a>  </li>
          <li class="nav-header">Modules</li>
    <li><a href="providence-core/index.html" title="Core"><span class="none"></span>Core</a>  </li>
    <li><a href="providence-core-client/index.html" title="Core : Client"><span class="none"></span>Core : Client</a>  </li>
    <li><a href="providence-core-server/index.html" title="Core : Server"><span class="none"></span>Core : Server</a>  </li>
    <li><a href="providence-reflect/index.html" title="Utils : Reflect"><span class="none"></span>Utils : Reflect</a>  </li>
    <li><a href="providence-thrift/index.html" title="Utils : Thrift Bridge"><span class="none"></span>Utils : Thrift Bridge</a>  </li>
    <li><a href="providence-testing/index.html" title="Utils : Testing"><span class="none"></span>Utils : Testing</a>  </li>
    <li><a href="providence-config/index.html" title="Utils : Config"><span class="none"></span>Utils : Config</a>  </li>
    <li><a href="providence-jax-rs/index.html" title="Utils : Javax-Ws-Rs"><span class="none"></span>Utils : Javax-Ws-Rs</a>  </li>
    <li><a href="providence-generator/index.html" title="Tools : Generator"><span class="none"></span>Tools : Generator</a>  </li>
    <li><a href="providence-generator-java/index.html" title="Tools : Generator - Java"><span class="none"></span>Tools : Generator - Java</a>  </li>
    <li><a href="providence-generator-json/index.html" title="Tools : Generator - JSON"><span class="none"></span>Tools : Generator - JSON</a>  </li>
    <li><a href="providence-maven-plugin/index.html" title="Tools : Maven Plugin"><span class="none"></span>Tools : Maven Plugin</a>  </li>
    <li><a href="providence-gradle-plugin.html" title="Tools : Gradle Plugin"><span class="none"></span>Tools : Gradle Plugin</a>  </li>
          <li class="nav-header">CLI Tools</li>
    <li><a href="providence-tools-converter.html" title="CLI : Converter"><span class="none"></span>CLI : Converter</a>  </li>
    <li><a href="providence-tools-rpc.html" title="CLI : RPC Tool"><span class="none"></span>CLI : RPC Tool</a>  </li>
    <li><a href="providence-tools-config.html" title="CLI : Config Helper"><span class="none"></span>CLI : Config Helper</a>  </li>
    <li><a href="providence-tools-compiler.html" title="CLI : Compiler"><span class="none"></span>CLI : Compiler</a>  </li>
          <li class="nav-header">Generator Options</li>
    <li><a href="options.html" title="Options Overview"><span class="none"></span>Options Overview</a>  </li>
    <li><a href="options-hazelcast.html" title="Hazelcast Portable"><span class="none"></span>Hazelcast Portable</a>  </li>
    <li><a href="options-android.html" title="Android Parcelable"><span class="none"></span>Android Parcelable</a>  </li>
    <li><a href="options-jackson.html" title="Jackson Annotations"><span class="none"></span>Jackson Annotations</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="release.html" title="Release Process"><span class="none"></span>Release Process</a>  </li>
    <li><a href="integration-testing.html" title="Integration Testing"><span class="none"></span>Integration Testing</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Serializer : Binary</a>
  </li>
    <li><a href="serializer-fast-binary.html" title="Serializer : Fast Binary"><span class="none"></span>Serializer : Fast Binary</a>  </li>
    <li><a href="serializer-json.html" title="Serializer : JSON"><span class="none"></span>Serializer : JSON</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Binary Serializer Format</h1>
<p>This is the original thrift binary protocol implementation for providence. The serializer serializes all numbers as big-endian, using no zig-zag encoding etc. It has a &#x201c;versioning&#x201d; system, but there is only one version of the original protocol; v1.</p>
<p>Per default the binary serializer will write the versioned data stream, but accept both versioned with v1 protocol and unversioned when deserializing. Setting the serializer to strict mode will only accept the desired protocol version.</p>
<div class="section">
<h2><a name="Service_calls"></a>Service calls</h2>
<p>Service calls comes in two versions, versioned and unversioned.</p>

<div class="source">
<div class="source"><pre class="prettyprint">CALL            :== VERSIONED | UNVERSIONED

VERSIONED       :== VERSION 0x00 CALL_TYPE [32-bit name-size] [name] [32-bit sequence] MESSAGE

UNVERSIONED     :== [32-bit name-size] [name] CALL_TYPE [32-bit sequence] MESSAGE

VERSION         :== 0x80 VERSION_NO

VERSION_NO      :== 0x01

CALL_TYPE       :== 0x01 | 0x02 | 0x03 | 0x04
</pre></div></div>
<p>The type of call is detected by reading the first 4 bytes as a signed int. If the value is less than 0, it is versioned (hence the 0x80 byte), otherwise it is unversioned. The number is split into version and call type by:</p>

<ul>
  
<li><tt>version   = (0x7FFF0000 &amp; num) &gt;&gt;&gt; 16</tt></li>
  
<li><tt>call_type = (byte) (0x000000FF &amp; num)</tt></li>
</ul>
<p>The &#x2018;middle&#x2019; 0 byte is currently not used. Each call type also determines what the &#x2018;message&#x2019; field can be, and if the call expects a reply or not.</p>

<div class="source">
<div class="source"><pre class="prettyprint">CALL       0x01 :== method request wrapper

REPLY      0x02 :== method response wrapper

EXCEPTION  0x03 :== application exception

ONEWAY     0x04 :== message request wrapper (no reply expected)
</pre></div></div>
<p>The call and oneway types are both method calls, where the oneway type does not expect, or require a reply. The call require a relply eve in the return type is &#x2018;void&#x2019;. This is where a &#x2018;field&#x2019; type can be void.</p>
<p><i><b>TODO:</b> Research original thrift reply-type handling of void return types.</i></p>
<p><i><b>TODO:</b> Update thrift-serializers or client / server to use this behavior.</i></p></div>
<div class="section">
<h2><a name="Messages"></a>Messages</h2>
<p>Messages are a stream of <tt>fields</tt>, and terminated with a 0-byte. Each field is self-contained. The null byte is in the place of the field type-id.</p>

<div class="source">
<div class="source"><pre class="prettyprint">MESSAGE         :== [FIELD]* STOP
</pre></div></div></div>
<div class="section">
<h2><a name="Fields"></a>Fields</h2>
<p>Each field is encoded as follows:</p>

<div class="source">
<div class="source"><pre class="prettyprint">STOP            :== 0x00

FIELD           :== TYPE FIELD_ID VALUE

FIELD_ID        :== 32-bit integer (the field ID)
</pre></div></div>
<div class="section">
<h3><a name="Encoding_of_values"></a>Encoding of values</h3>
<p>In the binary protocol, each thrift fields value type is mapped to a type ID. It is mostly a 1-to-1 mapping, but with a few exceptions.</p>
<p>The field types are:</p>

<div class="source">
<div class="source"><pre class="prettyprint">stop            :== 0

void            :== 1

bool            :== 2

byte            :== 3

double          :== 4

i16             :== 6

i32 | enum      :== 8

i64             :== 10

string | binary :== 11

message         :== 12

map             :== 13

set             :== 14

list            :== 15
</pre></div></div>
<p>And the values are encoded as:</p>

<div class="source">
<div class="source"><pre class="prettyprint">VALUE           :== VOID | BOOL | BYTE | I16 | I32 | I64 | DOUBLE | ENUM |
                    STRING | BINARY | MESSAGE | MAP | SET | LIST

VOID            :== [empty]

BOOL            :== (8-bit: 0 for false, 1 for true)

BYTE            :== (8-bit signed)

I16             :== (16-bit signed)

I32             :== (32-bit signed)

ENUM            :== (32-bit signed of value)

I64             :== (64-bit signed)

DOUBLE          :== (64-bit 1:11:52 encoded double, 64-bit float)

STRING          :== (32-bit size) (utf-8 encoded data)

BINARY          :== (32-bit size) (raw data)

MESSAGE         :== as a message

MAP             :== (8-bit key type) (8-bit item type) (32-bit size) N * ([key] [item])

LIST | SET      :== (8-bit item type) (32-bit size) N * (item)
</pre></div></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-3087264-4', 'auto');
                ga('send', 'pageview');
            </script>
        </div>
        </div>
    </footer>
    </body>
</html>
